import{a as T,b as q,u as H,s as S,e as J,r as C,x as K,l as V,k as d,g as r,y as _,n,j as o,t as c,h as Q,i as $,F as A,z as R,c as W,w as j,d as X,H as Y,o as i,v as Z,m as B}from"./main-BlFFzjiD.js";import{u as ee}from"./useForm-CrEMAn_Z.js";import{u as se}from"./roles-DDJ5ckSk.js";import{_ as re}from"./TextInput-Bnmnj4Km.js";import{_ as G}from"./Button-Cpf1tbOB.js";import{_ as oe}from"./Spinner-CbRJduN-.js";/* empty css            */const te={class:"flex items-center gap-4 mb-6"},ae={class:"flex items-center gap-2"},ne={class:"font-medium"},le={class:"mb-6"},ie={class:"mb-6"},de={key:0,class:"text-center py-8"},ce={key:1,class:"space-y-6"},me={class:"flex items-center justify-between mb-3"},ue=["onClick","disabled"],pe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},ge=["value","onUpdate:modelValue","disabled"],be={key:2,class:"mt-1 text-sm text-red-500"},$e={__name:"RolesForm",setup(ye){const h=J(),k=X(),b=se(),a=T(),y=q(),{t:m}=H(),v=S(()=>!!h.params.id),x=C(!1),u=C(!1),{form:t,errors:N,loading:P,getError:w}=ee({name:"",permissions:[]}),E=S(()=>{const e={};return b.permissions.forEach(s=>{const p=s.name.split(".")[0];e[p]||(e[p]=[]),e[p].push(s)}),e}),U=e=>({users:m("roles.permissionsGroups.users"),roles:m("roles.permissionsGroups.roles"),settings:m("roles.permissionsGroups.settings")})[e]||e.charAt(0).toUpperCase()+e.slice(1),F=e=>{const s=e.split(".");return s.length>1?s[1].charAt(0).toUpperCase()+s[1].slice(1):e},M=(e,s)=>s.every(p=>t.permissions.includes(p.name)),z=(e,s)=>{if(u.value)return;if(M(e,s))t.permissions=t.permissions.filter(l=>!s.some(g=>g.name===l));else{const l=s.map(g=>g.name);t.permissions=[...new Set([...t.permissions,...l])]}},D=async()=>{x.value=!0;try{await b.fetchPermissions()}catch(e){y.error(e.message||m("common.error"))}finally{x.value=!1}},I=async()=>{try{const e={name:t.name,permissions:t.permissions};if(v.value){const s=await b.update(h.params.id,e);y.success(s.message||m("roles.updateSuccess")),k.push("/admin/roles")}else{const s=await b.create(e);y.success(s.message||m("roles.createSuccess")),k.push("/admin/roles")}}catch(e){e.errors&&Object.keys(e.errors).forEach(s=>{N.value[s]=Array.isArray(e.errors[s])?e.errors[s][0]:e.errors[s]}),y.error(e.message||m("common.error"))}},L=async()=>{if(v.value)try{const e=await b.fetchOne(h.params.id);t.name=e.name,t.permissions=e.permissions?.map(s=>s.name)||[],u.value=e.is_system||!1}catch(e){y.error(e.message||m("common.error")),k.push("/admin/roles")}};return K(async()=>{await D(),await L()}),(e,s)=>{const p=Y("motion-fade");return V((i(),d("div",null,[r("div",te,[r("button",{onClick:s[0]||(s[0]=l=>e.$router.push("/admin/roles")),class:n(["p-2 rounded-lg transition-colors",o(a).darkMode?"hover:bg-gray-700 text-gray-300":"hover:bg-gray-100 text-gray-700"])},[...s[3]||(s[3]=[r("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],2),r("h1",{class:n(["text-3xl font-bold transition-colors",o(a).darkMode?"text-gray-100":"text-gray-900"])},c(v.value?e.$t("roles.editRole"):e.$t("roles.addNew")),3)]),u.value?(i(),d("div",{key:0,class:n(["mb-4 p-4 rounded-lg transition-colors",o(a).darkMode?"bg-blue-900/20 border border-blue-700 text-blue-400":"bg-blue-50 border border-blue-200 text-blue-800"])},[r("div",ae,[s[4]||(s[4]=r("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),r("span",ne,c(e.$t("roles.systemRoleInfo")),1)])],2)):_("",!0),r("div",{class:n(["rounded-lg shadow p-6 transition-colors",o(a).darkMode?"bg-gray-800 border border-gray-700":"bg-white"])},[r("form",{onSubmit:Q(I,["prevent"])},[r("div",le,[$(re,{modelValue:o(t).name,"onUpdate:modelValue":s[1]||(s[1]=l=>o(t).name=l),label:e.$t("roles.fields.name"),placeholder:e.$t("roles.placeholders.name"),error:o(w)("name"),disabled:u.value,required:""},null,8,["modelValue","label","placeholder","error","disabled"])]),r("div",ie,[r("label",{class:n(["block text-sm font-medium mb-3 transition-colors",o(a).darkMode?"text-gray-200":"text-gray-700"])},c(e.$t("roles.fields.permissions")),3),x.value?(i(),d("div",de,[$(oe,{text:e.$t("common.loading")},null,8,["text"])])):(i(),d("div",ce,[(i(!0),d(A,null,R(E.value,(l,g)=>(i(),d("div",{key:g,class:n(["p-4 rounded-lg transition-colors",o(a).darkMode?"bg-gray-900/50 border border-gray-700":"bg-gray-50 border border-gray-200"])},[r("div",me,[r("h3",{class:n(["font-semibold transition-colors",o(a).darkMode?"text-gray-100":"text-gray-900"])},c(U(g)),3),r("button",{type:"button",onClick:f=>z(g,l),class:n(["text-sm transition-colors",o(a).darkMode?"text-indigo-400 hover:text-indigo-300":"text-primary-600 hover:text-primary-700"]),disabled:u.value},c(M(g,l)?e.$t("common.unselectAll"):e.$t("common.selectAll")),11,ue)]),r("div",pe,[(i(!0),d(A,null,R(l,f=>(i(),d("label",{key:f.name,class:n(["flex items-center gap-2 p-2 rounded cursor-pointer transition-colors",[o(a).darkMode?"hover:bg-gray-800":"hover:bg-gray-100",u.value&&"opacity-50 cursor-not-allowed"]])},[V(r("input",{type:"checkbox",value:f.name,"onUpdate:modelValue":O=>o(t).permissions=O,disabled:u.value,class:n(["w-4 h-4 rounded transition-colors",o(a).darkMode?"bg-gray-700 border-gray-600 text-indigo-500":"bg-white border-gray-300 text-primary-600"])},null,10,ge),[[Z,o(t).permissions]]),r("span",{class:n(["text-sm transition-colors",o(a).darkMode?"text-gray-300":"text-gray-700"])},c(F(f.name)),3)],2))),128))])],2))),128))])),o(w)("permissions")?(i(),d("p",be,c(o(w)("permissions")),1)):_("",!0)]),r("div",{class:n(["flex items-center justify-end gap-4 pt-6 border-t transition-colors",o(a).darkMode?"border-gray-700":"border-gray-200"])},[$(G,{type:"button",variant:"secondary",onClick:s[2]||(s[2]=l=>e.$router.push("/admin/roles"))},{default:j(()=>[B(c(e.$t("common.cancel")),1)]),_:1}),u.value?_("",!0):(i(),W(G,{key:0,type:"submit",variant:"primary",loading:o(P)},{default:j(()=>[B(c(v.value?e.$t("common.update"):e.$t("common.create")),1)]),_:1},8,["loading"]))],2)],32)],2)])),[[p]])}}};export{$e as default};
